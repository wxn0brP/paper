{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": [
    "type Post = Awaited<ReturnType<typeof fetchNew>>;\n\nasync function fetchNewsCount() {\n    try {\n        const res = await fetch(\"/posts.txt\");\n        const newsCount = await res.text();\n        const count = +newsCount;\n        localStorage.setItem(\"newsCount\", count.toString());\n        return count;\n    } catch {\n        if (localStorage.getItem(\"newsCount\")) {\n            return +localStorage.getItem(\"newsCount\") || 0;\n        }\n        return 0;\n    }\n}\n\nasync function fetchNew(id: string) {\n    let post: string;\n\n    if (localStorage.getItem(`post-${id}`)) {\n        post = localStorage.getItem(`post-${id}`) || \"\";\n    } else {\n        const res = await fetch(`/post/${id}.txt`);\n        post = await res.text();\n        localStorage.setItem(`post-${id}`, post);\n    }\n\n    const lines = post.split(\"\\n\");\n    const title = lines.shift();\n    const date = lines.shift();\n    const url = lines.shift();\n    const icon = lines.shift();\n    const content = lines.join(\"\\n\");\n\n    return {\n        id,\n        date,\n        title,\n        url,\n        icon,\n        content,\n    };\n}\n\nfunction getViewedNews() {\n    const store = localStorage.getItem(\"viewedNews\");\n    if (!store) return [];\n    return store.split(\",\");\n}\n\nfunction markAsView(...ids: string[]) {\n    const viewedNews = getViewedNews();\n    const newViewedNews = [...viewedNews, ...ids];\n    const set = new Set(newViewedNews);\n    store.viewedNews = [...set];\n    localStorage.setItem(\"viewedNews\", [...set].join(\",\"));\n}\n\nfunction renderNews(news: Post[], viewedNews: string[]) {\n    const list = document.querySelector(\"#list\");\n    if (!list) return;\n    list.innerHTML = \"\";\n\n    news.forEach(_new => {\n        const newElement = document.createElement(\"article\");\n        newElement.className = \"news-card\";\n        newElement.classList.toggle(\"viewed\", viewedNews.includes(_new.id));\n        newElement.innerHTML = `\n            <div class=\"news-top-section\">\n                <div class=\"news-info\">\n                    <h2 class=\"news-title\">${_new.title}</h2>\n                    <div class=\"news-meta\">\n                        <span class=\"news-date\">${new Date(_new.date).toLocaleString() || \"\"}</span>\n                        ${_new.url ? `<a href=\"${_new.url}\" class=\"news-source-link\" target=\"_blank\">Source</a>` : \"\"}\n                    </div>\n                </div>\n                ${_new.icon ? `<div class=\"news-icon-wrapper\"><img class=\"news-icon\" src=\"${_new.icon}\" alt=\"\"></div>` : \"\"}\n            </div>\n            <div class=\"news-content-section\">\n                <details class=\"news-details\">\n                    <summary class=\"news-summary\">Read more</summary>\n                    <div class=\"news-text\">\n                        <p>${_new.content}</p>\n                    </div>\n                </details>\n            </div>\n        `;\n        newElement.addEventListener(\"click\", () => {\n            markAsView(_new.id);\n            newElement.classList.toggle(\"viewed\", true);\n        });\n\n        list.appendChild(newElement);\n    });\n}\n\nasync function fetchNews() {\n    const news = [] as Post[];\n    for (let i = store.newsCount; i >= 1; i--)\n        news.push(await fetchNew(i.toString()));\n    return news;\n}\n\nconst store = {\n    newsCount: 0,\n    news: [] as Post[],\n    viewedNews: [] as string[],\n};\n\nasync function init() {\n    store.newsCount = await fetchNewsCount();\n    store.viewedNews = getViewedNews();\n    store.news = await fetchNews();\n\n    renderNews(store.news, store.viewedNews);\n    console.log(store);\n}\n\nconst initPromise = init();\n(window as any).store = store;\n\nwindow.addEventListener(\"message\", async (e) => {\n    if (e.data.type === \"get-count\") {\n        e.source.postMessage({ type: \"count\", count: store.newsCount - store.viewedNews.length });\n    }\n    if (e.data.type === \"mark-as-viewed\") {\n        markAsView(...e.data.ids);\n        e.source.postMessage({ type: \"viewed-news\", news: store.viewedNews });\n    }\n    if (e.data.type === \"ready\") {\n        await initPromise;\n        e.source.postMessage({ type: \"ready\" });\n    }\n    if (e.data.type === \"set-css-var\") {\n        const name = e.data.name;\n        const value = e.data.value;\n        document.documentElement.style.setProperty(\"--\" + name, value);\n    }\n    if (e.data.type === \"get-store\") {\n        e.source.postMessage({ type: \"store\", store });\n    }\n});"
  ],
  "mappings": "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",
  "debugId": "AEF0871CABC2AF5364756E2164756E21",
  "names": []
}